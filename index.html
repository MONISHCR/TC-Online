<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ“</text></svg>'>
  <title>Transfer Certificate Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#667eea">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --glass-bg: rgba(255, 255, 255, 0.25);
      --glass-border: rgba(255, 255, 255, 0.18);
      --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      --shadow-heavy: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100dvh; /* better on mobile browsers with dynamic toolbars */
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      pointer-events: none;
      z-index: 1;
    }

    .container {
      position: relative;
      z-index: 2;
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      padding: 2rem clamp(0.75rem, 4vw, 1.25rem) 6rem; /* bottom space for floating action button on mobile */
    }

    .main-card {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 24px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-light);
      padding: 2.5rem;
      margin-bottom: 2rem;
      animation: slideUp 0.8s ease-out;
      width: 100%;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .header h1 {
      background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header p {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.1rem;
      font-weight: 400;
    }

    .form-floating {
      margin-bottom: 1.5rem;
      position: relative;
    }

    .form-control, .form-select {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      padding: 1rem 1.25rem;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      width: 100%;
    }

    .form-control:focus, .form-select:focus {
      background: rgba(255, 255, 255, 0.95);
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25), 0 8px 25px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    .form-floating > label {
      color: rgba(0, 0, 0, 0.6);
      font-weight: 500;
      padding: 1rem 1.25rem;
      white-space: normal; /* allow wrapping for long labels on mobile */
      line-height: 1.2;
      width: calc(100% - 2.5rem); /* prevent clipping due to padding */
    }

    .form-floating > .form-control:focus ~ label,
    .form-floating > .form-control:not(:placeholder-shown) ~ label,
    .form-floating > .form-select ~ label {
      color: #667eea;
      font-weight: 600;
    }

    .input-group {
      position: relative;
    }

    .input-icon {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(102, 126, 234, 0.7);
      z-index: 10;
      pointer-events: none;
    }

    .generate-btn {
      background: var(--primary-gradient);
      border: none;
      border-radius: 16px;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      box-shadow: var(--shadow-heavy);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .generate-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .generate-btn:hover::before {
      left: 100%;
    }

    .generate-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .generate-btn:active {
      transform: translateY(-1px);
    }

    .floating-btn {
      position: fixed;
      bottom: calc(1rem + env(safe-area-inset-bottom));
      left: calc(1rem + env(safe-area-inset-left));
      right: calc(1rem + env(safe-area-inset-right));
      z-index: 1000;
      background: var(--primary-gradient);
      border: none;
      border-radius: 20px;
      padding: 1.25rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .copyright {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.85rem;
      font-weight: 500;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .success-message {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--success-gradient);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: var(--shadow-heavy);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1001;
    }

    .success-message.show {
      transform: translateX(0);
    }

    @media (max-width: 768px) {
      .main-card {
        padding: clamp(1rem, 3.5vw, 1.5rem);
        margin: 1rem auto;
        border-radius: 20px;
      }
      
      .header h1 {
        font-size: clamp(1.5rem, 6vw, 2rem);
      }
      
      .form-control, .form-select {
        font-size: 1rem; /* >=16px to prevent iOS zoom */
        padding: 0.9rem 1rem;
      }
      
      .copyright {
        bottom: calc(6rem + env(safe-area-inset-bottom));
        right: 1rem;
        font-size: 0.8rem;
      }
    }

    /* Very small screens */
    @media (max-width: 360px) {
      .form-control, .form-select {
        font-size: 0.95rem;
        padding: 0.75rem 0.9rem;
      }
      .generate-btn {
        padding: 0.9rem 1.25rem;
        font-size: 1rem;
      }
      .floating-btn {
        padding: 1rem;
        font-size: 1rem;
      }
    }

    /* Make floating labels behave like top labels on very small screens */
    @media (max-width: 576px) {
      .form-floating > label {
        position: static;
        transform: none !important;
        padding: 0 0 0.4rem 0;
        width: 100%;
        opacity: 1 !important;
        color: rgba(0,0,0,0.85) !important;
        font-weight: 600;
        font-size: 0.95rem;
      }
      /* Put label above the control for mobile by reversing the DOM order visually */
      .form-floating {
        display: flex;
        flex-direction: column-reverse;
        gap: 0.25rem;
      }
      .form-floating > .form-control,
      .form-floating > .form-select {
        padding: 0.9rem 1rem !important;
        background: #fff !important;
        border: 1px solid #ced4da !important; /* cleaner bootstrap-like */
        box-shadow: none !important;
        border-radius: 12px !important;
        min-height: 3rem;
      }
      .form-floating > .form-control::placeholder {
        color: transparent; /* don't show placeholder text */
      }
      .main-card {
        background: #ffffff !important;
        -webkit-backdrop-filter: none !important;
        backdrop-filter: none !important;
        border: 1px solid rgba(0,0,0,0.06) !important;
        border-radius: 14px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        padding: 1rem !important;
      }
      .header h1 {
        margin-bottom: 0.25rem;
      }
      .form-floating { margin-bottom: 1rem; }
      /* Keep copyright from overlapping the FAB */
      .copyright { display: none; }
    }

    @media (min-width: 769px) {
      .floating-btn {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-card">
      <div class="header">
        <h1><i class="fas fa-graduation-cap"></i> Transfer Certificate Generator</h1>
        <p>Generate your official transfer certificate instantly</p>
      </div>

      <form id="tcForm" novalidate>
        <div class="form-floating">
          <input type="date" class="form-control" id="date" name="date" placeholder="Date" required autocomplete="off" inputmode="numeric">
          <label for="date"><i class="fas fa-calendar-alt me-2"></i>Date</label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="college_period" name="college_period" placeholder="2021-2025" required autocomplete="off" inputmode="text">
          <label for="college_period"><i class="fas fa-clock me-2"></i>College Period (EG:2021-2025) </label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="student_name" name="student_name" placeholder="Student Name" required autocomplete="name" autocapitalize="words">
          <label for="student_name"><i class="fas fa-user me-2"></i>Student Name</label>
        </div>

        <div class="form-floating">
          <select class="form-select" id="relation" name="relation" required>
            <option disabled selected value="">Choose...</option>
            <option value="S/o">S/o</option>
            <option value="D/o">D/o</option>
          </select>
          <label for="relation"><i class="fas fa-people-arrows me-2"></i>Relation (S/o or D/o)</label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="parent_name" name="parent_name" placeholder="Parent's Name" required autocomplete="off" autocapitalize="words">
          <label for="parent_name"><i class="fas fa-users me-2"></i>Parent's Name</label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="roll_no" name="roll_no" placeholder="21XXXXXX" required autocomplete="off" autocorrect="off" spellcheck="false" inputmode="text">
          <label for="roll_no"><i class="fas fa-id-card me-2"></i>Roll No ENTER FULL ROLL NO 21BDXXX</label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="admin_no" name="admin_no" placeholder="Admin No" required autocomplete="off" autocorrect="off" spellcheck="false" inputmode="text">
          <label for="admin_no"><i class="fas fa-hashtag me-2"></i>Admin No - please check on ID CARD </label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="branch" name="branch" placeholder="Branch & Section" required autocomplete="off" autocapitalize="characters">
          <label for="branch"><i class="fas fa-code-branch me-2"></i>Branch & Section</label>
        </div>

        <div class="form-floating">
          <input type="tel" class="form-control" id="mobile" name="mobile" placeholder="9876543210" pattern="[0-9]{10}" required inputmode="numeric" autocomplete="tel" maxlength="10">
          <label for="mobile"><i class="fas fa-phone me-2"></i>Mobile No</label>
        </div>

        <div class="form-floating">
          <input type="text" class="form-control" id="class_obtained" name="class_obtained" placeholder="First Class / Second Class / First Class with Distinction" required autocomplete="off" inputmode="text" autocapitalize="sentences">
          <label for="class_obtained"><i class="fas fa-award me-2"></i>Class Obtained (Like: First Class etc) please mention fully</label>
        </div>

        <div class="form-floating">
          <select class="form-select" id="category" name="category" required>
            <option disabled selected value="">Choose Category...</option>
            <option>OC</option>
            <option>BC-A</option>
            <option>BC-B</option>
            <option>BC-C</option>
            <option>BC-D</option>
            <option>BC-E</option>
            <option>SC</option>
            <option>ST</option>
          </select>
          <label for="category"><i class="fas fa-tags me-2"></i>Category</label>
        </div>

        <button type="button" class="btn generate-btn w-100 d-none d-md-block" onclick="generatePDF()">
          <i class="fas fa-file-pdf me-2"></i>Generate PDF Certificate
        </button>
      </form>
    </div>
  </div>

  <button type="button" class="btn floating-btn d-md-none" onclick="generatePDF()">
    <i class="fas fa-file-pdf me-2"></i>Generate PDF
  </button>

  <div class="copyright">
    &copy; Monish
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
  </div>

  <div class="success-message" id="successMessage">
    <i class="fas fa-check-circle me-2"></i>PDF Generated Successfully!
  </div>

  <script>
  async function ensureJsPDF() {
    if (window.jspdf && window.jspdf.jsPDF) return;
    // Try alternate CDN
    await new Promise((resolve, reject) => {
      const s = document.createElement('script');
      s.src = 'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js';
      s.async = true;
      s.onload = resolve;
      s.onerror = () => reject(new Error('Failed to load jsPDF fallback CDN'));
      document.head.appendChild(s);
    });
  }

  async function generatePDF() {
    const form = document.getElementById("tcForm");
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    const loading = document.getElementById('loading');
    const success = document.getElementById('successMessage');
    const actionableBtns = document.querySelectorAll('.generate-btn, .floating-btn');
    actionableBtns.forEach(b => b.disabled = true);
    loading.style.display = 'flex';

    try {
    // Ensure jsPDF is available (with fallback)
    await ensureJsPDF();
    if (!window.jspdf || !window.jspdf.jsPDF) {
      throw new Error('jsPDF library failed to load. Please check your internet connection.');
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });
    const data = Object.fromEntries(new FormData(form).entries());

    // Format date as dd/mm/yyyy
    const dateObj = new Date(data.date);
    const formattedDate = `${String(dateObj.getDate()).padStart(2,'0')}/${String(dateObj.getMonth()+1).padStart(2,'0')}/${dateObj.getFullYear()}`;

    // Use a built-in standard font name in lower-case per jsPDF docs
    doc.setFont("times", "normal");
    doc.setFontSize(12);

    // Date & Place aligned top right
    doc.text(`Date: ${formattedDate}`, 150, 20);
    doc.text("Hyderabad.", 150, 28);

    // Letter body
    let y = 45;
    doc.text("To,", 10, y); y+=6;
    doc.text("The Principal,", 10, y); y+=6;
    doc.text("KMIT,", 10, y); y+=6;
    doc.text("Narayanguda,", 10, y); y+=6;
    doc.text("Hyd 500029.", 10, y); y+=10;

    doc.text("Sub: Requesting for Transfer Certificate and Bonafide â€“ reg.", 10, y); y+=15;
    doc.text("Sir/Madam,", 10, y); y+=10;

    let body = `I ${data.student_name} ${data.relation} ${data.parent_name} with bearing Roll No. ${data.roll_no} and Admin. No. ${data.admin_no} studied in your college during period of ${data.college_period}, completed my four year B.Tech course successfully with ${data.class_obtained} and received all my original certificates which I have submitted at the time of admission.`;
    doc.text(body, 10, y, { maxWidth: 180, align: "justify" }); 
    y += 30;

    let req = "Now I request you to issue my T.C and BONAFIDE for my higher studies as per college procedure.";
    doc.text(req, 10, y, { maxWidth: 180, align: "justify" });
    y += 30;

    doc.text("Thanking you,", 10, y); y+=8;
    doc.text("Yours faithfully,", 10, y); y+=25;

    // Leave space for signature
    doc.text("Student Signature", 10, y); y+=10;

    // Student details below signature
    doc.text(`STUDENT NAME: ${data.student_name}`, 10, y); y+=6;
    doc.text(`ROLL No.: ${data.roll_no}`, 10, y); y+=6;
    doc.text(`ADMIN. No.: ${data.admin_no}`, 10, y); y+=6;
    doc.text(`BRANCH & SECTION: ${data.branch}`, 10, y); y+=6;
    doc.text(`MOBILE. No.: ${data.mobile}`, 10, y); y+=6;
    doc.text(`CATEGORY: ${data.category}`, 10, y);

    // Save PDF
    doc.save("Transfer_Certificate.pdf");
    success.classList.add('show');
    setTimeout(() => success.classList.remove('show'), 2500);
  } catch (e) {
    console.error('PDF generation failed:', e);
    alert('Failed to generate PDF. Please try again.');
  } finally {
    loading.style.display = 'none';
    actionableBtns.forEach(b => b.disabled = false);
  }
}
</script>
</body>
</html>
